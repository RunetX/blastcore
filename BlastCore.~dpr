program BlastCore;

uses
  Forms,
  Windows,
  ArchiverUnit in 'ArchiverUnit.pas' {MainForm},
  GroupInfoUnit in 'GroupInfo\GroupInfoUnit.pas' {GroupInfoForm},
  SendMessageUnit in 'SendMessage\SendMessageUnit.pas' {SendMessageForm},
  ChatYESNOUnit in 'BChat\ChatYESNOUnit.pas' {ChatYESNOForm},
  TryChatUnit in 'BChat\TryChatUnit.pas' {TryChatForm},
  OptionsUnit in 'Options\OptionsUnit.pas' {OptionsForm},
  IgnorlistUnit in 'IgnoreManager\IgnorlistUnit.pas' {IgnorelistForm},
  AboutUnit in 'About\AboutUnit.pas' {AboutForm},
  SentMesUnit in 'SentMessages\SentMesUnit.pas' {SentMesForm},
  NewChatUnit in 'BChat\NewChatUnit.pas' {BChatForm},
  GetArchiveUnit in 'GetArchive\GetArchiveUnit.pas' {GetArchiveForm};

{$R *.res}

var
  PrevWin: HWND;

function TryCreateMutex: Boolean;
var
  Mutex: THandle;
begin
  Result:=true;
  Mutex:=CreateMutex(nil,true,'любой текст');
  if GetLastError = ERROR_ALREADY_EXISTS then Result:=false;
  ReleaseMutex(Mutex);
end;

begin
  if not TryCreateMutex then begin
    PrevWin:=FindWindow('TMainForm','MainForm');
    SendMessage(PrevWin,UM_MYMESSSAGE,0,0);
  end
  else  
  begin
    Application.Initialize;
    Application.CreateForm(TMainForm, MainForm);
  Application.CreateForm(TGroupInfoForm, GroupInfoForm);
  Application.CreateForm(TSendMessageForm, SendMessageForm);
  Application.CreateForm(TChatYESNOForm, ChatYESNOForm);
  Application.CreateForm(TTryChatForm, TryChatForm);
  Application.CreateForm(TOptionsForm, OptionsForm);
  Application.CreateForm(TIgnorelistForm, IgnorelistForm);
  Application.CreateForm(TAboutForm, AboutForm);
  Application.CreateForm(TSentMesForm, SentMesForm);
  Application.CreateForm(TBChatForm, BChatForm);
  Application.CreateForm(TGetArchiveForm, GetArchiveForm);
  Application.Run;
  end;
end.
