= Графическое представление протокола SEA Sender =

Все длины и идентификаторы - в сетевом порядке байт (сначала старший, потом младший).

http://blastcore.googlecode.com/files/incoming.png

http://blastcore.googlecode.com/files/outgoing.png

*Отличия команды #4 от показанного на схеме:*

После тела сообщения идёт еще один байт, обозначающий длину. Если он нулевой, как в подавлящем большинстве случаев, более никаких байт не идет. Если он ненулевой, то это длина следующего поля - имени пользователя, за которым идет байт длины имени компьютера, и затем собственно имя компьютера - то есть, структура такая же, как в команде #2, если из неё убрать байт #2 и ID. Эти имя пользователя и компьютера используются в том случае, если сообщение пришло из TCPSender, причем ID отправителя неизвестен (является нулевым). _Зачем это нужно и когда может случиться, никто не знает, надо спрашивать авторов оригинального Java-сервера._

Специальные значения и константы:

 * ID=0 используется как идентификатор группы всех пользователей
 * ID=65535 используется как идентификатор группы Печатников
 * Факультет с ASCII-значением '1' означает АВТФ
 * Реализация оригинального Java-сервера и штатного клиента использует номер 1000 как разделитель идентификаторов клиентов SEA Sender и TCPSender - в команде #2 не предусмотрено флага, в который из списков следует добавить пользователя, и они различаются этой константой (если идентификатор более 1000, то это пользователь TCPSender).

Замечания по схеме, вытекающие из реализации:

 * Оригинальный клиент (до версии 0.9.7.4 включительно), по-видимому, использует знаковое представление чисел - замечено на байтах длины в чате и в имени пользователя (приводит к явным ошибкам переполнения буфера и выпадению в дебаггер). По-видимому, то же применимо и к идентификаторам пользователей, хотя значение  65535 == -1 обрабатывается верно, на практике проверено не было.
    * Считаю, что это ошибка штатного клиента, и все эти числа следует трактовать как беззнаковые. -- nuclight
 * Поле isPrinter в команде #4 от сервера представляет собой два байта, каждый из которых установлен в единицу, если это сообщение для группы Печатников, и два нуля в противном случае.

Реализация чата - документировать позднее.